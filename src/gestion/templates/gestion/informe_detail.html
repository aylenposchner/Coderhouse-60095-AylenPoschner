{% extends 'core/base.html' %}

{% block contenido %}
{% load humanize %}
    <h1 style="text-align: center; margin-top: 30px;">Detalle Informe</h1>

    <ul>
        <li style="margin-left: 40px;"><strong>Nombre:</strong> {{object.nombre}}</li>
        <li style="margin-left: 40px;"><strong>Año:</strong> {{object.año}}</li>
        <li style="margin-left: 40px;"><strong>Informe:</strong> {{object.informe}}</li>
        <li style="margin-left: 40px;"><strong>Periodo: </strong>{{object.get_periodo_display}}</li>
    </ul>
        
    <!-- Gráfico -->
    {% if etiquetas and total %}
    <h3 style="text-align: center;">Gráfico de {{ object.informe }}</h3>
    <canvas id="grafico" width="400" height="100"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('grafico').getContext('2d');

        const etiqueta = {{etiquetas|safe }};
        const totales = {{total|safe}};
        const ingreso = {{ingresos|safe}};
        const gasto = {{gastos|safe}};

        const data = {
            labels: etiqueta,
            datasets: [
                {
                label: 'Ingresos por {{ object.get_periodo_display }}',
                data: ingreso,
                backgroundColor: 'rgba(54, 162, 235, 0.3)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
                },
                {
                label: 'Gastos por {{ object.get_periodo_display }}',
                data: gasto,
                backgroundColor: 'rgba(255, 99, 132, 0.3)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
                },
                {
                label: 'Totales por {{ object.get_periodo_display }}',
                data: totales,
                backgroundColor: 'rgba(138, 43, 226, 0.3)',
                borderColor: 'rgba(138, 43, 226, 1)',
                borderWidth: 1
                }
        ]
        };

        new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
    {% else %}
        <p>No hay datos disponibles para mostrar en el gráfico.</p>
    {% endif %}
    <br>

    <a href="{% url 'gestion:informe_list' %}"><button>Volver a Informes</button></a>
{% endblock contenido %}